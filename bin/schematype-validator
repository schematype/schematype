#!/usr/bin/env coffee

module.paths.unshift "#{require('path').dirname(__dirname)}/lib"

require 'ingy-prelude'
require 'schematype-validator/validator'
{ArgumentParser} = require 'argparse'

ap = new ArgumentParser \
  usage: "usage: schematype-validator <type-name> <stx-file> <data-file>...",
  version: SchemaTypeValidator.VERSION
ap.addArgument '--type',
  defaultValue: 'Main'
ap.addArgument 'stx_file'
ap.addArgument 'data_file'
args = ap.parseArgs()
{type, stx_file, data_file} = args

throw "Input file does not exist: '#{stx_file}'" \
  unless stx_file == '-' or file_exists stx_file

schema = JSON.parse file_read stx_file

validator = new SchemaTypeValidator.Validator

exit validator.validate schema, 'Main', data_file

# vim: sw=2:
